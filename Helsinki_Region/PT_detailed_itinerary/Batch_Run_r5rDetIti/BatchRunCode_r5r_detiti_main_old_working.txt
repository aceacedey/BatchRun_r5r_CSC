#!/bin/bash
#SBATCH --job-name=myBacthJobTest
#SBATCH --account=project_2010418
#SBATCH --time=2-23:59:59
#SBATCH --partition=small##large##test##small##interactive
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=1
#SBATCH --mem-per-cpu=200G
##SBATCH --export=ALL
#SBATCH --array=1-300
#SBATCH --output=/scratch/project_2011005/Helsinki_Region_Emission_Calculation/Codes_Car_PT_CO2_calculation_Sept2024/PT_detailed_itinerary/Slurm_out_files/Slurm_out_files_601_900/%j.out
### /scratch/project_2011005/Helsinki_Region_Emission_Calculation/Codes_Car_PT_CO2_calculation_Sept2024/PT_detailed_itinerary/Slurm_out_files/Slurm_out_files_0_300
##SBATCH --mail-type=BEGIN #uncomment to enable mail

##Slurm array task id # change values from [0, 300, 600, 900, 1200, 1500, 1800]
iD=$((SLURM_ARRAY_TASK_ID + 600)) 

# Departure datetime string
D_DT=(20-04-2023)  ## 2023-04-20
D_TM=(07:30:00)

# Max walk time and trip duration
m_WT=30   # minutes
m_TD=120 # minutes

# Path to ODs
OD=(/projappl/project_2011005/Helsinki_Region_Emission_Calculation/Codes_Car_PT_CO2_calculation_Sept2024/PT_detailed_itinerary/Batch_Run_r5rDetIti/R_code_for_BatchRun/Data/h3_OD_Hexagons_Helsinki_latlon_filtered.csv)

# Path to MapData
MapData=(/projappl/project_2011005/Helsinki_Region_Emission_Calculation/Codes_Car_PT_CO2_calculation_Sept2024/PT_detailed_itinerary/Batch_Run_r5rDetIti/R_code_for_BatchRun/Data/Helsinki_map_data)


# Outputname for TXT-files
OUTNAME=DetIti_DDMMYY

# Path to Results
RESULTS=(/scratch/project_2011005/Helsinki_Region_Emission_Calculation/Codes_Car_PT_CO2_calculation_Sept2024/PT_detailed_itinerary/Batch_output/Batch_output_601_900) ## change values here


module load biojava
module load r-env


export _JAVA_OPTIONS=-Djava.io.tmpdir=/projappl/project_2010418/JAVA_packages/temp

#Data slicing indexes
echo "Job Started :"`date`
chunk_size=5
frm=$((1 + chunk_size * iD))
to=$((frm +chunk_size-1))

Rscript /projappl/project_2011005/Helsinki_Region_Emission_Calculation/Codes_Car_PT_CO2_calculation_Sept2024/PT_detailed_itinerary/Batch_Run_r5rDetIti/R_code_for_BatchRun/rcode_MobiTartu2024.R $MapData $OD $RESULTS $D_DT $D_TM $frm $to $iD $m_WT $m_TD ##$SLURM_ARRAY_TASK_ID

echo "Job stopped :"`date`

